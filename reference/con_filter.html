<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter a dataframe using two-way criteria to increase connectedness — con_filter • connected</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter a dataframe using two-way criteria to increase connectedness — con_filter"><meta name="description" content="Traditional filtering (subsetting) of data is typically performed via
some criteria based on the columns of the data.
In contrast, this function performs filtering of data based on the
joint rows and columns of a matrix-view of two factors.
Conceptually, the idea is to re-shape two or three columns of a dataframe
into a matrix, and then delete entire rows (or columns) of the matrix if
there are too many missing cells in a row (or column).
The two most useful applications of two-way filtering are to:
Remove a factor level that has few interactions with another factor.
This is especially useful in mixed models to remove rare factor combinations.
Remove a factor level that has any missing interactions with another
factor. This is especially useful with biplots of a matrix to remove
rows or columns that have missing values.


A formula syntax is used to specify the two-way filtering criteria.
Some examples may provide the easiest understanding.
dat &amp;lt;- data.frame(state=c(&quot;NE&quot;,&quot;NE&quot;, &quot;IA&quot;, &quot;NE&quot;, &quot;IA&quot;),
year=c(1,2,2,3,3), value=11:15)
When the 'value' column is re-shaped into a matrix it looks like:
state/year |  1 |  2 |  3 |
NE | 11 | 12 | 14 |
IA |    | 13 | 15 |
Drop states with too much missing combinations.
Keep only states with &quot;at least 3 years per state&quot;
con_filter(dat, ~ 3 * year / state)
NE    1    11
NE    2    12
NE    3    14
Keep only years with &quot;at least 2 states per year&quot;
con_filter(dat, ~ 2 * state / year)
NE    2    12
IA    2    13
NE    3    14
IA    3    15
If the constant number in the formula is less than 1.0, this is
interpreted as a fraction.
Keep only states with &quot;at least 75% of years per state&quot;
con_filter(dat, ~ .75 * year / state)
It is possible to include another factor on either side of the slash &quot;/&quot;.
Suppose the data had another factor for political party called &quot;party&quot;.
Keep only states with &quot;at least 2 combinations of party:year per state&quot;
con_filter(dat, ~ 2 * party:year / state)
If the formula contains a response variable, missing values are dropped
first, then the two-way filtering is based on the factor combinations.
con_filter(dat, value ~ 2 * state / year)"><meta property="og:description" content="Traditional filtering (subsetting) of data is typically performed via
some criteria based on the columns of the data.
In contrast, this function performs filtering of data based on the
joint rows and columns of a matrix-view of two factors.
Conceptually, the idea is to re-shape two or three columns of a dataframe
into a matrix, and then delete entire rows (or columns) of the matrix if
there are too many missing cells in a row (or column).
The two most useful applications of two-way filtering are to:
Remove a factor level that has few interactions with another factor.
This is especially useful in mixed models to remove rare factor combinations.
Remove a factor level that has any missing interactions with another
factor. This is especially useful with biplots of a matrix to remove
rows or columns that have missing values.


A formula syntax is used to specify the two-way filtering criteria.
Some examples may provide the easiest understanding.
dat &amp;lt;- data.frame(state=c(&quot;NE&quot;,&quot;NE&quot;, &quot;IA&quot;, &quot;NE&quot;, &quot;IA&quot;),
year=c(1,2,2,3,3), value=11:15)
When the 'value' column is re-shaped into a matrix it looks like:
state/year |  1 |  2 |  3 |
NE | 11 | 12 | 14 |
IA |    | 13 | 15 |
Drop states with too much missing combinations.
Keep only states with &quot;at least 3 years per state&quot;
con_filter(dat, ~ 3 * year / state)
NE    1    11
NE    2    12
NE    3    14
Keep only years with &quot;at least 2 states per year&quot;
con_filter(dat, ~ 2 * state / year)
NE    2    12
IA    2    13
NE    3    14
IA    3    15
If the constant number in the formula is less than 1.0, this is
interpreted as a fraction.
Keep only states with &quot;at least 75% of years per state&quot;
con_filter(dat, ~ .75 * year / state)
It is possible to include another factor on either side of the slash &quot;/&quot;.
Suppose the data had another factor for political party called &quot;party&quot;.
Keep only states with &quot;at least 2 combinations of party:year per state&quot;
con_filter(dat, ~ 2 * party:year / state)
If the formula contains a response variable, missing values are dropped
first, then the two-way filtering is based on the factor combinations.
con_filter(dat, value ~ 2 * state / year)"><meta property="og:image" content="https://kwstat.github.io/connected/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">connected</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction_to_the_connected_package.html">Introduction to the 'connected' package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filter a dataframe using two-way criteria to increase connectedness</h1>

      <div class="d-none name"><code>con_filter.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Traditional filtering (subsetting) of data is typically performed via
some criteria based on the <em>columns</em> of the data.</p>
<p>In contrast, this function performs filtering of data based on the
<em>joint</em> rows and columns of a matrix-view of two factors.</p>
<p>Conceptually, the idea is to re-shape two or three columns of a dataframe
into a matrix, and then delete entire rows (or columns) of the matrix if
there are too many missing cells in a row (or column).</p>
<p>The two most useful applications of two-way filtering are to:</p><ol><li><p>Remove a factor level that has few interactions with another factor.
This is especially useful in mixed models to remove rare factor combinations.</p></li>
<li><p>Remove a factor level that has any missing interactions with another
factor. This is especially useful with biplots of a matrix to remove
rows or columns that have missing values.</p></li>
</ol><p>A formula syntax is used to specify the two-way filtering criteria.</p>
<p>Some examples may provide the easiest understanding.</p>
<p>dat &lt;- data.frame(state=c("NE","NE", "IA", "NE", "IA"),
year=c(1,2,2,3,3), value=11:15)</p>
<p>When the 'value' column is re-shaped into a matrix it looks like:</p>
<p>state/year |  1 |  2 |  3 |
NE | 11 | 12 | 14 |
IA |    | 13 | 15 |</p>
<p>Drop states with too much missing combinations.
Keep only states with "at least 3 years per state"
con_filter(dat, ~ 3 * year / state)
NE    1    11
NE    2    12
NE    3    14</p>
<p>Keep only years with "at least 2 states per year"
con_filter(dat, ~ 2 * state / year)
NE    2    12
IA    2    13
NE    3    14
IA    3    15</p>
<p>If the constant number in the formula is less than 1.0, this is
interpreted as a <em>fraction</em>.
Keep only states with "at least 75% of years per state"
con_filter(dat, ~ .75 * year / state)</p>
<p>It is possible to include another factor on either side of the slash "/".
Suppose the data had another factor for political party called "party".
Keep only states with "at least 2 combinations of party:year per state"
con_filter(dat, ~ 2 * party:year / state)</p>
<p>If the formula contains a response variable, missing values are dropped
first, then the two-way filtering is based on the factor combinations.
con_filter(dat, value ~ 2 * state / year)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">con_filter</span><span class="op">(</span><span class="va">data</span>, <span class="va">formula</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, returndropped <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A dataframe.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula that specifies the criteria for filtering.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>If TRUE, print some diagnostic information about what data
is being deleted. (Similar to the 'tidylog' package).</p></dd>


<dt id="arg-returndropped">returndropped<a class="anchor" aria-label="anchor" href="#arg-returndropped"></a></dt>
<dd><p>If TRUE, return the dropped rows instead of the
kept rows. Default is FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The original dataframe is returned, minus rows that are filtered out.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>None.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Kevin Wright</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  gen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G3"</span>, <span class="st">"G4"</span>, <span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"G3"</span>, <span class="st">"G4"</span>, <span class="st">"G5"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"G3"</span>, <span class="st">"G4"</span>, <span class="st">"G5"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"G3"</span>, <span class="st">"G4"</span>, <span class="st">"G5"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"G1"</span>, <span class="st">"G2"</span>, <span class="st">"G3"</span>, <span class="st">"G4"</span>, <span class="st">"G5"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E1"</span>, <span class="st">"E1"</span>, <span class="st">"E1"</span>, <span class="st">"E1"</span>, <span class="st">"E1"</span>, <span class="st">"E1"</span>, <span class="st">"E1"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"E2"</span>, <span class="st">"E2"</span>, <span class="st">"E2"</span>, <span class="st">"E2"</span>, <span class="st">"E2"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"E3"</span>, <span class="st">"E3"</span>, <span class="st">"E3"</span>, <span class="st">"E3"</span>, <span class="st">"E3"</span>,</span></span>
<span class="r-in"><span>          <span class="st">"E4"</span>, <span class="st">"E4"</span>, <span class="st">"E4"</span>, <span class="st">"E4"</span>, <span class="st">"E4"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  yield <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">50</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">65</span>, <span class="fl">50</span>, <span class="fl">60</span>,</span></span>
<span class="r-in"><span>            <span class="cn">NA</span>, <span class="fl">71</span>, <span class="fl">76</span>, <span class="fl">80</span>, <span class="fl">82</span>,</span></span>
<span class="r-in"><span>            <span class="fl">90</span>, <span class="fl">93</span>, <span class="fl">95</span>, <span class="fl">102</span>, <span class="fl">97</span>,</span></span>
<span class="r-in"><span>            <span class="fl">98</span>, <span class="fl">102</span>, <span class="fl">105</span>, <span class="fl">130</span>, <span class="fl">135</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># How many observations are there for each combination of gen*env?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">yield</span><span class="op">)</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">gen</span>,<span class="va">env</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     env</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gen  E1 E2 E3 E4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   G1  0  0  1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   G2  0  1  1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   G3  2  1  1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   G4  2  1  1  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   G5  1  1  1  1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note, if there is no response variable, the two-way filtering is based</span></span></span>
<span class="r-in"><span><span class="co"># only on the presence of the factor combinations.</span></span></span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="op">~</span> <span class="fl">4</span><span class="op">*</span><span class="va">env</span> <span class="op">/</span> <span class="va">gen</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 0 of 22 rows of data.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If there is a response variable, missing values are dropped first,</span></span></span>
<span class="r-in"><span><span class="co"># then the two-way filtering is based on the factor combinations.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">4</span><span class="op">*</span><span class="va">env</span><span class="op">/</span><span class="va">gen</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 2 of 5 levels of gen:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "G1" "G2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 5 of 19 rows of data.</span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">5</span><span class="op">*</span><span class="va">env</span><span class="op">/</span> <span class="va">gen</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 5 of 5 levels of gen:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "G1" "G2" "G3" "G4" "G5"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 19 of 19 rows of data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No data remains.</span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">6</span><span class="op">*</span><span class="va">gen</span><span class="op">/</span> <span class="va">env</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 4 of 4 levels of env:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "E1" "E2" "E3" "E4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 19 of 19 rows of data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No data remains.</span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">.8</span> <span class="op">*</span><span class="va">env</span> <span class="op">/</span> <span class="va">gen</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 2 of 5 levels of gen:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "G1" "G2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 5 of 19 rows of data.</span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">.8</span><span class="op">*</span> <span class="va">gen</span> <span class="op">/</span> <span class="va">env</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 1 of 4 levels of env:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "E1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 5 of 19 rows of data.</span>
<span class="r-in"><span><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">con_filter</span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="fl">7</span> <span class="op">*</span> <span class="va">env</span> <span class="op">/</span> <span class="va">gen</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Dropping these 5 of 5 levels of gen:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "G1" "G2" "G3" "G4" "G5"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deleted 19 of 19 rows of data.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No data remains.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

